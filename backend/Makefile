.PHONY: help build up down restart logs clean rebuild dev-up dev-down dev-restart

help: ## Afficher cette aide
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

build: ## Compiler les services
	docker-compose build

up: ## DÃ©marrer tous les services
	docker-compose up -d

down: ## ArrÃªter tous les services
	docker-compose down

restart: ## RedÃ©marrer tous les services
	docker-compose restart

logs: ## Afficher les logs de tous les services
	docker-compose logs -f

logs-main: ## Afficher les logs de main-api
	docker-compose logs -f main-api

logs-image: ## Afficher les logs de image-service
	docker-compose logs -f image-service

clean: ## ArrÃªter et supprimer les volumes
	docker-compose down -v

rebuild: ## Rebuild et redÃ©marrer tous les services
	docker-compose down
	docker-compose build --no-cache
	docker-compose up -d

dev-up: ## DÃ©marrer l'environnement de dÃ©veloppement
	@echo "ğŸš€ DÃ©marrage de l'environnement de dÃ©veloppement..."
	docker-compose up -d postgres-main postgres-image minio
	@echo "â³ Attente du dÃ©marrage des bases de donnÃ©es..."
	@sleep 10
	@echo "âœ… Environnement de dÃ©veloppement prÃªt!"
	@echo "ğŸ“Š PostgreSQL Main API : localhost:5432"
	@echo "ğŸ“Š PostgreSQL Image Service : localhost:5555"
	@echo "ğŸ—‚ï¸  MinIO Console : http://localhost:9001 (minioadmin/minioadmin)"
	@echo "ğŸ—‚ï¸  MinIO API : http://localhost:9000"

dev-down: ## ArrÃªter l'environnement de dÃ©veloppement
	docker-compose down

dev-restart: ## RedÃ©marrer l'environnement de dÃ©veloppement
	docker-compose restart postgres-main postgres-image minio

dev: dev-up ## Alias pour dev-up

full-up: ## DÃ©marrer tous les services (DB + applications)
	@echo "ğŸš€ DÃ©marrage de tous les services..."
	docker-compose up -d
	@echo "âœ… Tous les services sont dÃ©marrÃ©s!"
	@echo "ğŸŒ Main API : http://localhost:5001"
	@echo "ğŸŒ Image Service : http://localhost:5002"
	@echo "ğŸ“Š PostgreSQL Main API : localhost:5432"
	@echo "ğŸ“Š PostgreSQL Image Service : localhost:5555"
	@echo "ğŸ—‚ï¸  MinIO Console : http://localhost:9001"

status: ## Afficher le status de tous les services
	docker-compose ps

ps: status ## Alias pour status

